<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Simulaci√≥n de Redes - Integratel Per√∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            transition: background 0.3s;
        }

        body.light-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        }

        .animated-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        h1 {
            color: white;
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
            font-weight: 300;
            animation: fadeIn 2s ease-in-out infinite alternate;
        }

        @keyframes fadeIn {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }

        .container {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .dark-mode .panel {
            background: rgba(30, 30, 30, 0.95);
            color: white;
        }

        .panel h3 {
            margin-bottom: 15px;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .dark-mode .panel h3 {
            color: #88a4ff;
            border-bottom-color: #88a4ff;
        }

        .device-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .device-item {
            padding: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 8px;
            cursor: grab;
            text-align: center;
            transition: transform 0.2s;
            font-size: 0.9em;
        }

        .device-item:hover {
            transform: scale(1.05);
        }

        #canvas-container {
            position: relative;
            height: 600px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .dark-mode #canvas-container {
            background: rgba(20, 20, 20, 0.95);
        }

        #network-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .console {
            height: 250px;
            overflow-y: auto;
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            line-height: 1.6;
        }

        .console-line {
            margin-bottom: 8px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            padding: 15px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 10px;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .dark-mode .stat-value {
            color: #88a4ff;
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .dark-mode .stat-label {
            color: #aaa;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: transform 0.3s;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: rotate(180deg);
        }

        #chart-container {
            height: 200px;
            margin-top: 20px;
        }

        @media (max-width: 1400px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            #canvas-container {
                height: 500px;
            }
        }

        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            animation: slideIn 0.3s;
        }

        .alert-warning {
            background: rgba(245, 87, 108, 0.2);
            border: 2px solid #f5576c;
            color: #f5576c;
        }

        .dark-mode .alert-warning {
            color: #ff8899;
        }
    </style>
</head>
<body class="light-mode">
    <div class="animated-bg">
        <canvas id="bg-canvas"></canvas>
    </div>

    <div class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
        <span id="theme-icon">üåô</span>
    </div>

    <header>
        <div class="logo">IP</div>
        <h1>Centro de Simulaci√≥n y Dise√±o de Redes ‚Äì Integratel Per√∫ S.A.A</h1>
        <p class="subtitle">Dise√±a, simula y eval√∫a tu infraestructura tecnol√≥gica de forma profesional</p>
    </header>

    <div class="container">
        <div class="panel">
            <h3>üì¶ Dispositivos</h3>
            <div class="device-list">
                <div class="device-item" draggable="true" data-device="router">üîÄ Router</div>
                <div class="device-item" draggable="true" data-device="switch">üîÑ Switch</div>
                <div class="device-item" draggable="true" data-device="server">üñ•Ô∏è Servidor</div>
                <div class="device-item" draggable="true" data-device="pc">üíª PC</div>
                <div class="device-item" draggable="true" data-device="firewall">üõ°Ô∏è Firewall</div>
                <div class="device-item" draggable="true" data-device="ap">üì° Access Point</div>
            </div>

            <div class="controls" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="autoDesign()">üé® Auto Dise√±ar</button>
                <button class="btn btn-warning" onclick="clearNetwork()">üóëÔ∏è Limpiar</button>
            </div>
        </div>

        <div>
            <div class="panel" style="padding: 15px; margin-bottom: 15px;">
                <div class="controls">
                    <button class="btn btn-success" onclick="startSimulation()">‚ñ∂Ô∏è Iniciar Simulaci√≥n</button>
                    <button class="btn btn-info" onclick="stopSimulation()">‚è∏Ô∏è Detener</button>
                    <button class="btn btn-primary" onclick="generatePDF()">üìÑ Generar PDF</button>
                    <button class="btn btn-warning" onclick="exportImage()">üì∑ Exportar PNG</button>
                </div>
            </div>

            <div id="canvas-container">
                <canvas id="network-canvas"></canvas>
            </div>

            <div class="panel" style="margin-top: 15px;">
                <h3>üìä Consola de Simulaci√≥n</h3>
                <div class="console" id="console"></div>
            </div>
        </div>

        <div class="panel">
            <h3>üìà Estad√≠sticas en Tiempo Real</h3>
            
            <div id="alerts"></div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="device-count">0</div>
                    <div class="stat-label">Dispositivos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="connection-count">0</div>
                    <div class="stat-label">Conexiones</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="latency">0ms</div>
                    <div class="stat-label">Latencia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="status">üî¥</div>
                    <div class="stat-label">Estado</div>
                </div>
            </div>

            <div id="chart-container">
                <canvas id="traffic-chart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        var devices = [];
        var connections = [];
        var isSimulating = false;
        var simulationInterval = null;
        var deviceCounter = { router: 0, switch: 0, server: 0, pc: 0, firewall: 0, ap: 0 };
        var trafficData = [0, 0, 0, 0, 0, 0, 0];
        var chart = null;
        var currentDesign = 0;
        var selectedDevice = null;
        var draggedDevice = null;
        var dragOffset = { x: 0, y: 0 };

        const canvas = document.getElementById('network-canvas');
        const ctx = canvas.getContext('2d');
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');

        const deviceIcons = {
            router: 'üîÄ',
            switch: 'üîÑ',
            server: 'üñ•Ô∏è',
            pc: 'üíª',
            firewall: 'üõ°Ô∏è',
            ap: 'üì°'
        };

        // Funciones principales
        function resizeCanvas() {
            const container = document.getElementById('canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            bgCanvas.width = window.innerWidth;
            bgCanvas.height = window.innerHeight;
            drawNetwork();
        }

        function addDevice(type, x, y) {
            deviceCounter[type]++;
            const device = {
                id: type + '-' + deviceCounter[type],
                type: type,
                x: x,
                y: y,
                icon: deviceIcons[type],
                label: type.toUpperCase() + '-' + deviceCounter[type]
            };
            devices.push(device);
            updateStats();
            drawNetwork();
            logConsole('‚úÖ Dispositivo a√±adido: ' + device.label);
        }

        function drawNetwork() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            connections.forEach(function(conn) {
                const dev1 = devices.find(function(d) { return d.id === conn.from; });
                const dev2 = devices.find(function(d) { return d.id === conn.to; });
                if (dev1 && dev2) {
                    ctx.beginPath();
                    ctx.moveTo(dev1.x, dev1.y);
                    ctx.lineTo(dev2.x, dev2.y);
                    ctx.strokeStyle = conn.active ? '#00ff00' : '#667eea';
                    ctx.lineWidth = conn.active ? 4 : 2;
                    ctx.stroke();
                }
            });
            
            devices.forEach(function(device) {
                ctx.font = '32px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(device.icon, device.x, device.y);
                ctx.font = 'bold 12px Poppins';
                ctx.fillStyle = '#333';
                ctx.fillText(device.label, device.x, device.y + 30);
            });
        }

        function autoDesign() {
            clearNetwork();
            const cX = canvas.width / 2;
            const cY = canvas.height / 2;
            
            if (currentDesign === 0) {
                logConsole('üé® Generando dise√±o: Red Corporativa Est√°ndar');
                addDevice('router', cX, cY - 100);
                addDevice('firewall', cX - 150, cY - 100);
                addDevice('switch', cX, cY + 50);
                addDevice('server', cX + 150, cY + 50);
                addDevice('pc', cX - 150, cY + 150);
                addDevice('pc', cX, cY + 180);
                addDevice('pc', cX + 150, cY + 150);
                addDevice('ap', cX - 250, cY + 50);
                setTimeout(function() {
                    if (devices.length >= 8) {
                        connections.push({ from: devices[1].id, to: devices[0].id, active: false });
                        connections.push({ from: devices[0].id, to: devices[2].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[3].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[4].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[5].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[6].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[7].id, active: false });
                        updateStats();
                        drawNetwork();
                    }
                }, 100);
            } else if (currentDesign === 1) {
                logConsole('üé® Generando dise√±o: Red de Sucursales');
                addDevice('router', cX, cY);
                addDevice('firewall', cX, cY - 100);
                addDevice('router', cX - 250, cY);
                addDevice('switch', cX - 250, cY + 100);
                addDevice('pc', cX - 300, cY + 150);
                addDevice('pc', cX - 200, cY + 150);
                addDevice('router', cX + 250, cY);
                addDevice('switch', cX + 250, cY + 100);
                addDevice('pc', cX + 200, cY + 150);
                addDevice('pc', cX + 300, cY + 150);
                addDevice('server', cX, cY + 120);
                setTimeout(function() {
                    if (devices.length >= 11) {
                        connections.push({ from: devices[1].id, to: devices[0].id, active: false });
                        connections.push({ from: devices[0].id, to: devices[2].id, active: false });
                        connections.push({ from: devices[0].id, to: devices[6].id, active: false });
                        connections.push({ from: devices[0].id, to: devices[10].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[3].id, active: false });
                        connections.push({ from: devices[3].id, to: devices[4].id, active: false });
                        connections.push({ from: devices[3].id, to: devices[5].id, active: false });
                        connections.push({ from: devices[6].id, to: devices[7].id, active: false });
                        connections.push({ from: devices[7].id, to: devices[8].id, active: false });
                        connections.push({ from: devices[7].id, to: devices[9].id, active: false });
                        updateStats();
                        drawNetwork();
                    }
                }, 100);
            } else if (currentDesign === 2) {
                logConsole('üé® Generando dise√±o: Red de Data Center');
                addDevice('router', cX, cY - 150);
                addDevice('firewall', cX - 120, cY - 150);
                addDevice('firewall', cX + 120, cY - 150);
                addDevice('switch', cX - 150, cY);
                addDevice('switch', cX + 150, cY);
                addDevice('server', cX - 200, cY + 100);
                addDevice('server', cX - 100, cY + 100);
                addDevice('server', cX + 100, cY + 100);
                addDevice('server', cX + 200, cY + 100);
                addDevice('switch', cX, cY + 180);
                setTimeout(function() {
                    if (devices.length >= 10) {
                        connections.push({ from: devices[1].id, to: devices[0].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[0].id, active: false });
                        connections.push({ from: devices[0].id, to: devices[3].id, active: false });
                        connections.push({ from: devices[0].id, to: devices[4].id, active: false });
                        connections.push({ from: devices[3].id, to: devices[5].id, active: false });
                        connections.push({ from: devices[3].id, to: devices[6].id, active: false });
                        connections.push({ from: devices[4].id, to: devices[7].id, active: false });
                        connections.push({ from: devices[4].id, to: devices[8].id, active: false });
                        connections.push({ from: devices[3].id, to: devices[9].id, active: false });
                        connections.push({ from: devices[4].id, to: devices[9].id, active: false });
                        updateStats();
                        drawNetwork();
                    }
                }, 100);
            } else if (currentDesign === 3) {
                logConsole('üé® Generando dise√±o: Red Mesh con Redundancia');
                const radius = 150;
                for (var i = 0; i < 6; i++) {
                    const angle = (i * 60) * Math.PI / 180;
                    const x = cX + radius * Math.cos(angle);
                    const y = cY + radius * Math.sin(angle);
                    addDevice('router', x, y);
                }
                addDevice('switch', cX, cY);
                addDevice('firewall', cX, cY - 220);
                addDevice('server', cX, cY + 220);
                setTimeout(function() {
                    if (devices.length >= 9) {
                        for (var i = 0; i < 6; i++) {
                            connections.push({ from: devices[i].id, to: devices[6].id, active: false });
                        }
                        for (var i = 0; i < 6; i++) {
                            connections.push({ from: devices[i].id, to: devices[(i + 1) % 6].id, active: false });
                        }
                        connections.push({ from: devices[7].id, to: devices[6].id, active: false });
                        connections.push({ from: devices[6].id, to: devices[8].id, active: false });
                        updateStats();
                        drawNetwork();
                    }
                }, 100);
            } else if (currentDesign === 4) {
                logConsole('üé® Generando dise√±o: Red Empresarial con DMZ');
                addDevice('firewall', cX, cY - 180);
                addDevice('router', cX, cY - 100);
                addDevice('switch', cX, cY);
                addDevice('server', cX - 120, cY + 50);
                addDevice('server', cX + 120, cY + 50);
                addDevice('firewall', cX, cY + 120);
                addDevice('switch', cX - 150, cY + 200);
                addDevice('switch', cX + 150, cY + 200);
                addDevice('pc', cX - 220, cY + 260);
                addDevice('pc', cX - 80, cY + 260);
                addDevice('pc', cX + 80, cY + 260);
                addDevice('pc', cX + 220, cY + 260);
                setTimeout(function() {
                    if (devices.length >= 12) {
                        connections.push({ from: devices[0].id, to: devices[1].id, active: false });
                        connections.push({ from: devices[1].id, to: devices[2].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[3].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[4].id, active: false });
                        connections.push({ from: devices[2].id, to: devices[5].id, active: false });
                        connections.push({ from: devices[5].id, to: devices[6].id, active: false });
                        connections.push({ from: devices[5].id, to: devices[7].id, active: false });
                        connections.push({ from: devices[6].id, to: devices[8].id, active: false });
                        connections.push({ from: devices[6].id, to: devices[9].id, active: false });
                        connections.push({ from: devices[7].id, to: devices[10].id, active: false });
                        connections.push({ from: devices[7].id, to: devices[11].id, active: false });
                        updateStats();
                        drawNetwork();
                    }
                }, 100);
            }
            
            logConsole('‚úÖ Dise√±o completado');
            currentDesign = (currentDesign + 1) % 5;
        }

        function clearNetwork() {
            devices = [];
            connections = [];
            deviceCounter = { router: 0, switch: 0, server: 0, pc: 0, firewall: 0, ap: 0 };
            updateStats();
            drawNetwork();
            document.getElementById('console').innerHTML = '';
            logConsole('üóëÔ∏è Red limpiada');
        }

        function startSimulation() {
            if (devices.length === 0) {
                logConsole('‚ö†Ô∏è No hay dispositivos en la red');
                return;
            }
            isSimulating = true;
            logConsole('‚ñ∂Ô∏è Iniciando simulaci√≥n de red...');
            checkConnectivity();
            connections.forEach(function(conn) { conn.active = true; });
            drawNetwork();
            var step = 0;
            simulationInterval = setInterval(function() {
                step++;
                const messages = [
                    'üîç Firewall inspecciona tr√°fico entrante...',
                    '‚úÖ Ping exitoso entre dispositivos',
                    'üåê Resolviendo DNS...',
                    'üì° Transmitiendo paquetes...',
                    '‚è±Ô∏è Latencia media: ' + (Math.floor(Math.random() * 30 + 15)) + 'ms',
                    'üîí Conexi√≥n segura establecida',
                    'üìä Actualizando tabla de enrutamiento...'
                ];
                if (step % 2 === 0) {
                    logConsole(messages[Math.floor(Math.random() * messages.length)]);
                }
                trafficData.push(Math.floor(Math.random() * 100));
                trafficData.shift();
                updateChart();
                document.getElementById('latency').textContent = (Math.floor(Math.random() * 30 + 15)) + 'ms';
                document.getElementById('status').textContent = 'üü¢';
            }, 1500);
        }

        function stopSimulation() {
            isSimulating = false;
            clearInterval(simulationInterval);
            connections.forEach(function(conn) { conn.active = false; });
            drawNetwork();
            document.getElementById('status').textContent = 'üî¥';
            logConsole('‚è∏Ô∏è Simulaci√≥n detenida');
        }

        function checkConnectivity() {
            const connectedDevices = new Set();
            connections.forEach(function(conn) {
                connectedDevices.add(conn.from);
                connectedDevices.add(conn.to);
            });
            const alertDiv = document.getElementById('alerts');
            alertDiv.innerHTML = '';
            devices.forEach(function(device) {
                if (!connectedDevices.has(device.id)) {
                    alertDiv.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è Dispositivo no conectado: ' + device.label + '</div>';
                    logConsole('‚ö†Ô∏è Advertencia: ' + device.label + ' no est√° conectado');
                }
            });
        }

        function updateStats() {
            document.getElementById('device-count').textContent = devices.length;
            document.getElementById('connection-count').textContent = connections.length;
        }

        function logConsole(message) {
            const consoleEl = document.getElementById('console');
            const time = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = 'console-line';
            line.textContent = '[' + time + '] ' + message;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function initChart() {
            const chartCanvas = document.getElementById('traffic-chart');
            chart = new Chart(chartCanvas, {
                type: 'line',
                data: {
                    labels: ['', '', '', '', '', '', ''],
                    datasets: [{
                        label: 'Tr√°fico (Mbps)',
                        data: trafficData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });
        }

        function updateChart() {
            if (chart) {
                chart.data.datasets[0].data = trafficData;
                chart.update('none');
            }
        }

        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                icon.textContent = '‚òÄÔ∏è';
            } else {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                icon.textContent = 'üåô';
            }
        }

        function exportImage() {
            const link = document.createElement('a');
            link.download = 'red-integratel-' + Date.now() + '.png';
            link.href = canvas.toDataURL();
            link.click();
            logConsole('üì∑ Imagen exportada exitosamente');
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(20);
            doc.setTextColor(102, 126, 234);
            doc.text('Integratel Per√∫ S.A.A', 105, 20, { align: 'center' });
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Informe de Dise√±o de Red Empresarial', 105, 30, { align: 'center' });
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            const now = new Date();
            doc.text('Fecha: ' + now.toLocaleDateString() + ' - Hora: ' + now.toLocaleTimeString(), 105, 38, { align: 'center' });
            doc.setDrawColor(102, 126, 234);
            doc.setLineWidth(0.5);
            doc.line(20, 42, 190, 42);
            doc.setFontSize(14);
            doc.setTextColor(102, 126, 234);
            doc.text('Resumen Ejecutivo', 20, 52);
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text('Total de Dispositivos: ' + devices.length, 20, 60);
            doc.text('Total de Conexiones: ' + connections.length, 20, 67);
            doc.text('Estado de la Red: ' + (isSimulating ? 'En Simulaci√≥n' : 'Detenida'), 20, 74);
            doc.text('Latencia Promedio: ' + document.getElementById('latency').textContent, 20, 81);
            doc.setFontSize(14);
            doc.setTextColor(102, 126, 234);
            doc.text('Inventario de Dispositivos', 20, 95);
            doc.setFontSize(9);
            doc.setTextColor(0, 0, 0);
            var yPos = 103;
            const deviceTypes = { router: 'Routers', switch: 'Switches', server: 'Servidores', pc: 'Computadoras', firewall: 'Firewalls', ap: 'Access Points' };
            Object.keys(deviceCounter).forEach(function(type) {
                if (deviceCounter[type] > 0) {
                    doc.text('‚Ä¢ ' + deviceTypes[type] + ': ' + deviceCounter[type] + ' unidad(es)', 25, yPos);
                    yPos += 6;
                }
            });
            doc.setFontSize(14);
            doc.setTextColor(102, 126, 234);
            doc.text('Diagrama de Topolog√≠a', 20, yPos + 10);
            const imgData = canvas.toDataURL('image/png');
            doc.addImage(imgData, 'PNG', 20, yPos + 15, 170, 100);
            yPos += 120;
            if (yPos > 250) {
                doc.addPage();
                yPos = 20;
            }
            doc.setFontSize(14);
            doc.setTextColor(102, 126, 234);
            doc.text('Matriz de Conexiones', 20, yPos);
            doc.setFontSize(9);
            doc.setTextColor(0, 0, 0);
            yPos += 8;
            if (connections.length > 0) {
                connections.forEach(function(conn, index) {
                    if (yPos > 280) {
                        doc.addPage();
                        yPos = 20;
                    }
                    const dev1 = devices.find(function(d) { return d.id === conn.from; });
                    const dev2 = devices.find(function(d) { return d.id === conn.to; });
                    if (dev1 && dev2) {
                        doc.text((index + 1) + '. ' + dev1.label + ' ‚Üî ' + dev2.label, 25, yPos);
                        yPos += 6;
                    }
                });
            } else {
                doc.text('No hay conexiones configuradas', 25, yPos);
                yPos += 6;
            }
            if (yPos > 240) {
                doc.addPage();
                yPos = 20;
            } else {
                yPos += 10;
            }
            doc.setFontSize(14);
            doc.setTextColor(102, 126, 234);
            doc.text('Log de Actividad', 20, yPos);
            doc.setFontSize(8);
            doc.setTextColor(0, 0, 0);
            yPos += 8;
            const consoleLines = document.getElementById('console').getElementsByClassName('console-line');
            const lastLines = Array.from(consoleLines).slice(-15);
            lastLines.forEach(function(line) {
                if (yPos > 280) {
                    doc.addPage();
                    yPos = 20;
                }
                const text = line.textContent;
                const splitText = doc.splitTextToSize(text, 170);
                doc.text(splitText, 25, yPos);
                yPos += 5 * splitText.length;
            });
            const pageCount = doc.internal.getNumberOfPages();
            for (var i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                doc.text('P√°gina ' + i + ' de ' + pageCount, 105, 290, { align: 'center' });
                doc.text('¬© 2025 Integratel Per√∫ S.A.A - Todos los derechos reservados', 105, 295, { align: 'center' });
            }
            doc.save('informe-red-integratel-' + Date.now() + '.pdf');
            logConsole('üìÑ Informe PDF generado exitosamente');
        }

        // Event listeners
        window.addEventListener('resize', resizeCanvas);
        
        document.querySelectorAll('.device-item').forEach(function(item) {
            item.addEventListener('dragstart', function(e) {
                e.dataTransfer.setData('device', e.target.dataset.device);
            });
        });

        canvas.addEventListener('dragover', function(e) { e.preventDefault(); });
        
        canvas.addEventListener('drop', function(e) {
            e.preventDefault();
            const deviceType = e.dataTransfer.getData('device');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            addDevice(deviceType, x, y);
        });

        canvas.addEventListener('click', function(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const clicked = devices.find(function(d) { return Math.abs(d.x - x) < 30 && Math.abs(d.y - y) < 30; });
            if (clicked) {
                if (!selectedDevice) {
                    selectedDevice = clicked;
                    logConsole('üîó Dispositivo seleccionado: ' + clicked.label);
                } else {
                    if (selectedDevice.id !== clicked.id) {
                        connections.push({ from: selectedDevice.id, to: clicked.id, active: false });
                        logConsole('‚úÖ Conexi√≥n creada: ' + selectedDevice.label + ' ‚Üî ' + clicked.label);
                        updateStats();
                        drawNetwork();
                    }
                    selectedDevice = null;
                }
            }
        });

        canvas.addEventListener('mousedown', function(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            draggedDevice = devices.find(function(d) { return Math.abs(d.x - x) < 30 && Math.abs(d.y - y) < 30; });
            if (draggedDevice) {
                dragOffset.x = x - draggedDevice.x;
                dragOffset.y = y - draggedDevice.y;
                canvas.style.cursor = 'grabbing';
            }
        });

        canvas.addEventListener('mousemove', function(e) {
            if (draggedDevice) {
                const rect = canvas.getBoundingClientRect();
                draggedDevice.x = e.clientX - rect.left - dragOffset.x;
                draggedDevice.y = e.clientY - rect.top - dragOffset.y;
                drawNetwork();
            }
        });

        canvas.addEventListener('mouseup', function() {
            if (draggedDevice) {
                draggedDevice = null;
                canvas.style.cursor = 'crosshair';
            }
        });

        canvas.addEventListener('mouseleave', function() {
            if (draggedDevice) {
                draggedDevice = null;
                canvas.style.cursor = 'crosshair';
            }
        });

        // Background animation
        var bgNodes = [];
        for (var i = 0; i < 50; i++) {
            bgNodes.push({
                x: Math.random() * window.innerWidth,
                y: Math.random() * window.innerHeight,
                vx: (Math.random() - 0.5) * 0.5,
                vy: (Math.random() - 0.5) * 0.5
            });
        }

        function animateBackground() {
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            bgCtx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            bgNodes.forEach(function(node, i) {
                node.x += node.vx;
                node.y += node.vy;
                if (node.x < 0 || node.x > bgCanvas.width) node.vx *= -1;
                if (node.y < 0 || node.y > bgCanvas.height) node.vy *= -1;
                bgCtx.beginPath();
                bgCtx.arc(node.x, node.y, 2, 0, Math.PI * 2);
                bgCtx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                bgCtx.fill();
                bgNodes.slice(i + 1).forEach(function(other) {
                    const dx = other.x - node.x;
                    const dy = other.y - node.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 150) {
                        bgCtx.beginPath();
                        bgCtx.moveTo(node.x, node.y);
                        bgCtx.lineTo(other.x, other.y);
                        bgCtx.stroke();
                    }
                });
            });
            requestAnimationFrame(animateBackground);
        }

        // Inicializaci√≥n
        resizeCanvas();
        animateBackground();
        initChart();
        
        logConsole('üöÄ Sistema de simulaci√≥n inicializado');
        logConsole('üí° Arrastra dispositivos al canvas o usa "Auto Dise√±ar"');
        logConsole('üîó Haz clic en dos dispositivos para conectarlos');
        setTimeout(function() {
            logConsole('‚ú® Centro de Simulaci√≥n y Dise√±o de Redes - Integratel Per√∫');
            logConsole('üìä Sistema listo para crear infraestructuras empresariales');
        }, 1000);
        updateStats();
    </script>
</body>
</html>
